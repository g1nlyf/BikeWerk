# FMV Collection Scripts

Скрипты для сбора данных FMV (Fair Market Value) из трех источников: buycycle, bikeflip, kleinanzeigen.

## Тестовый скрипт

Проверяет работу сбора данных на нескольких моделях и годах:

```bash
node backend/scripts/test-fmv-collection-three-sources.js
```

**Что делает:**
- Собирает данные для YT Tues, YT Capra, Specialized Status
- Годы: 2015, 2016, 2017
- По 20 записей с каждого источника
- Проверяет сохранение в `market_history`
- Выводит статистику по источникам

## Масштабный скрипт

Собирает данные для всех моделей из whitelist и годов 2015-2025:

```bash
# Полный сбор
node backend/scripts/full-fmv-collection-2015-2025.js

# Тестовый режим (без сохранения)
node backend/scripts/full-fmv-collection-2015-2025.js --dry-run

# С ограничением записей на источник
node backend/scripts/full-fmv-collection-2015-2025.js --limit=10
```

**Что делает:**
- Загружает whitelist из `backend/config/fmv-whitelist.json`
- Генерирует план сбора для всех моделей × все годы (2015-2025) × 3 источника
- Собирает данные параллельно с трех источников
- Сохраняет в таблицу `market_history`
- Выводит подробную статистику

**Пример расчета задач:**
- 5 брендов × ~4 модели = 20 моделей
- 20 моделей × 11 лет (2015-2025) = 220 комбинаций
- 220 комбинаций × 3 источника = **660 задач**

## Структура данных

Данные сохраняются в таблицу `market_history` со следующими полями:
- `brand`, `model`, `year` - модель и год
- `source_platform` - источник ('buycycle', 'bikeflip', 'kleinanzeigen')
- `source_url` - URL объявления
- `source_ad_id` - ID объявления
- `price_eur` - цена в евро
- `title` - заголовок объявления
- `frame_size` - размер рамы (если доступен)
- `scraped_at` - время сбора

## Примечания

- Скрипты автоматически пропускают дубликаты по `source_platform` + `source_ad_id`
- Между запросами есть задержки (2-3 секунды) для избежания блокировок
- При ошибках скрипт продолжает работу и выводит статистику в конце
- Рекомендуется сначала запустить тестовый скрипт для проверки
